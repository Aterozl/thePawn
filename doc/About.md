<h1>the Pawn</h1>

<i>Этот документ - описание сущностей и их взаимодействия в первом приближении.</i>

<h2>Сущности</h2>
<ul>
<li>host - Атомарная единица, имеет уникальный ip и установленный клиент приложения. Знает о себе: последние версии установленных пакетов, статусы выполненых задач (только фейл, в работе и последние версии инсталед), а также принадлежность себя к тегам.</li>
<li>tag - Абстрактная групировка хостов и тегов. Служит для обобщения хостов по смыслу. Напрямую к хосту запросы не идут только через обращение к тегу. Умеет выдовать summary по задаче. Умеет интегрироваться с фаерволом для распространения правил, умеет выключать/включать машинки из балансировки.</li>
<li>task - Атомарная единица. Содержит набор правил, передоваемых для выполнения на теги.</li>
<li>way - Атомарный элемент. По сути однонаправленный граф. Является представлением последовательности тегов на которых надо выполнить задачу. Привязан к package. Хранит в себе знание какая по версии задача на какой точке (в конце забывает).</li>
<li>package - сущность содержащая шаблон задачи, в который подставляются переменные параметры типа версии, и путь. Умеет делать задачи и контролировать их.</li>
</ul>

<h2>Клиент</h2>

Это веб сервер, который работает в двух режимах.
<ol>
<li>Ждёт входящих http сообщений (новый таск, статус по таску, статус по всем таскам, состоние системы в целом, состояние определённой проверки)</li>
<li>По крону проверяет, не появилось ли новых не выполненных задач на сервере (частота должна регулироваться в конфиге)</li>
</ol>

Также этот сервер знает о проверках (bash скрипты) и умеет их исполнять